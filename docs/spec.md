# json_compare

JSON形式のデータを意味的類似度で比較するツール

## 概要

json_compareは、2つのJSON形式データを比較し、フィールド名の一致率と値の意味的類似度を組み合わせた総合スコアを算出します。日本語埋め込みベクトルモデル（cl-nagoya/ruri-v3-310m）を使用し、テキストの意味的な類似性を評価できます。

## 主な特徴

- **構造的比較**: JSONのフィールド名一致率を計算
- **意味的比較**: 日本語埋め込みベクトルによる値の類似度評価
- **再帰的処理**: ネストされたオブジェクトやリストも比較可能
- **JSON修復機能**: 不完全なJSONも自動修復して処理

## CLI使用方法

### 入力パラメータ

1. **ファイル指定**
   - ローカルファイルパス
   - ファイルアクセスURL（外部API経由）

2. **結果形式（type）**

   - `"score"`: 総合評価スコアを返す
     ```json
     {
       "file": "入力ファイル名またはURL",
       "score": 0.85,
       "meaning": 0.92,
       "json": 0.78
     }
     ```
     - score: 総合スコア（0-1）
     - meaning: 意味的類似度
     - json: 構造的類似度

   - `"file"`: 行ごとの詳細比較結果を追加したファイルURLを返す

### 出力

指定したtypeに応じた形式で結果を返します。

## 類似度計算アルゴリズム

総合類似度 = フィールド名一致率（A） × フィールド値類似度（B）

- **A**: 共通フィールド数 ÷ 最大フィールド数
- **B**: 共通フィールドの値の平均類似度
  - 完全一致: 1.0
  - 数値: 一致で1.0、不一致で0.1
  - テキスト: 埋め込みベクトルのコサイン類似度
  - リスト/オブジェクト: 再帰的に計算

## 使用例

```bash
# スコア形式で結果を取得
python -m json_compare input1.json input2.json --type score

# 詳細比較結果をファイルで取得
python -m json_compare data1.jsonl data2.jsonl --type file
```

